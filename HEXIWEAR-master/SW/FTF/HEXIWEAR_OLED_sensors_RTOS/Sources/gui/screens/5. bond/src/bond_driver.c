
/*! *********************************************************************************
*************************************************************************************
* Include
*************************************************************************************
********************************************************************************** */

#include "gui_driver.h"
#include "screens_common.h"
#include "bond_private.h"
#include "power_driver.h"

/************************************************************************************
*************************************************************************************
* Private type definitions
*************************************************************************************
************************************************************************************/

/*! *********************************************************************************
*************************************************************************************
* Private macros
*************************************************************************************
********************************************************************************** */

/*! @brief Converts milliseconds to ticks*/
#define MSEC_TO_TICK(msec)  (((uint32_t)(msec)+500uL/(uint32_t)configTICK_RATE_HZ) \
                             *(uint32_t)configTICK_RATE_HZ/1000uL)


/*! *********************************************************************************
*************************************************************************************
* Private prototypes
*************************************************************************************
********************************************************************************** */


/*! *********************************************************************************
*************************************************************************************
* Public memory declarations
*************************************************************************************
********************************************************************************** */

/*! *********************************************************************************
*************************************************************************************
* Private memory declarations
*************************************************************************************
********************************************************************************** */

static uint32_t bond_passkey;

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/**
 * [bond_Init description]
 * @param param [description]
 */

void bond_Init( void *param )
{
	if(&bondScreen != (guiScreen_t*) param)
	{
	bondScreen.navigation.left = (guiScreen_t*) param;
	}

	GuiDriver_LabelCreate(&bond_label);

	sprintf((char*)bond_label.caption, "%lu", bond_passkey);
	GuiDriver_LabelAddToScr(&bond_label);

	// disable power save
	power_DisablePowerSave();
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/**
 * [bond_DestroyTasks description]
 * @param param [description]
 */

void bond_DestroyTasks( void *param )
{
	OLED_DestroyDynamicArea();
	GuiDriver_LabelDestroy(&bond_label);

	// enable power save
	power_EnablePowerSave();
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/**
 * [bond_SetPasskey description]
 * @param passkey [description]
 */

void bond_SetPasskey(uint32_t passkey)
{
	bond_passkey = passkey;
}
